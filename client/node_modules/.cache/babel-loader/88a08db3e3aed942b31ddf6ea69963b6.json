{"ast":null,"code":"import WrapperMatrix2D from '../wrap/WrapperMatrix2D';\nimport Matrix from '../matrix';\nexport default class nipals {\n  constructor(X, options = {}) {\n    X = WrapperMatrix2D.checkMatrix(X);\n    let {\n      Y\n    } = options;\n    const {\n      scaleScores = false,\n      maxIterations = 1000,\n      terminationCriteria = 1e-10\n    } = options;\n    let u;\n\n    if (Y) {\n      if (Array.isArray(Y) && typeof Y[0] === 'number') {\n        Y = Matrix.columnVector(Y);\n      } else {\n        Y = WrapperMatrix2D.checkMatrix(Y);\n      }\n\n      if (!Y.isColumnVector() || Y.rows !== X.rows) {\n        throw new Error('Y must be a column vector of length X.rows');\n      }\n\n      u = Y;\n    } else {\n      u = X.getColumnVector(0);\n    }\n\n    let diff = 1;\n    let t, q, w, tOld;\n\n    for (let counter = 0; counter < maxIterations && diff > terminationCriteria; counter++) {\n      w = X.transpose().mmul(u).div(u.transpose().mmul(u).get(0, 0));\n      w = w.div(w.norm());\n      t = X.mmul(w).div(w.transpose().mmul(w).get(0, 0));\n\n      if (counter > 0) {\n        diff = t.clone().sub(tOld).pow(2).sum();\n      }\n\n      tOld = t.clone();\n\n      if (Y) {\n        q = Y.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n        q = q.div(q.norm());\n        u = Y.mmul(q).div(q.transpose().mmul(q).get(0, 0));\n      } else {\n        u = t;\n      }\n    }\n\n    if (Y) {\n      let p = X.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      p = p.div(p.norm());\n      let xResidual = X.clone().sub(t.clone().mmul(p.transpose()));\n      let residual = u.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      let yResidual = Y.clone().sub(t.clone().mulS(residual.get(0, 0)).mmul(q.transpose()));\n      this.t = t;\n      this.p = p.transpose();\n      this.w = w.transpose();\n      this.q = q;\n      this.u = u;\n      this.s = t.transpose().mmul(t);\n      this.xResidual = xResidual;\n      this.yResidual = yResidual;\n      this.betas = residual;\n    } else {\n      this.w = w.transpose();\n      this.s = t.transpose().mmul(t).sqrt();\n\n      if (scaleScores) {\n        this.t = t.clone().div(this.s.get(0, 0));\n      } else {\n        this.t = t;\n      }\n\n      this.xResidual = X.sub(t.mmul(w.transpose()));\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/Archish/node_modules/ml-matrix/src/dc/nipals.js"],"names":["WrapperMatrix2D","Matrix","nipals","constructor","X","options","checkMatrix","Y","scaleScores","maxIterations","terminationCriteria","u","Array","isArray","columnVector","isColumnVector","rows","Error","getColumnVector","diff","t","q","w","tOld","counter","transpose","mmul","div","get","norm","clone","sub","pow","sum","p","xResidual","residual","yResidual","mulS","s","betas","sqrt"],"mappings":"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","sourcesContent":["import WrapperMatrix2D from '../wrap/WrapperMatrix2D';\nimport Matrix from '../matrix';\n\nexport default class nipals {\n  constructor(X, options = {}) {\n    X = WrapperMatrix2D.checkMatrix(X);\n    let { Y } = options;\n    const {\n      scaleScores = false,\n      maxIterations = 1000,\n      terminationCriteria = 1e-10,\n    } = options;\n\n    let u;\n    if (Y) {\n      if (Array.isArray(Y) && typeof Y[0] === 'number') {\n        Y = Matrix.columnVector(Y);\n      } else {\n        Y = WrapperMatrix2D.checkMatrix(Y);\n      }\n      if (!Y.isColumnVector() || Y.rows !== X.rows) {\n        throw new Error('Y must be a column vector of length X.rows');\n      }\n      u = Y;\n    } else {\n      u = X.getColumnVector(0);\n    }\n\n    let diff = 1;\n    let t, q, w, tOld;\n\n    for (\n      let counter = 0;\n      counter < maxIterations && diff > terminationCriteria;\n      counter++\n    ) {\n      w = X.transpose()\n        .mmul(u)\n        .div(\n          u\n            .transpose()\n            .mmul(u)\n            .get(0, 0),\n        );\n      w = w.div(w.norm());\n\n      t = X.mmul(w).div(\n        w\n          .transpose()\n          .mmul(w)\n          .get(0, 0),\n      );\n\n      if (counter > 0) {\n        diff = t\n          .clone()\n          .sub(tOld)\n          .pow(2)\n          .sum();\n      }\n      tOld = t.clone();\n\n      if (Y) {\n        q = Y.transpose()\n          .mmul(t)\n          .div(\n            t\n              .transpose()\n              .mmul(t)\n              .get(0, 0),\n          );\n        q = q.div(q.norm());\n\n        u = Y.mmul(q).div(\n          q\n            .transpose()\n            .mmul(q)\n            .get(0, 0),\n        );\n      } else {\n        u = t;\n      }\n    }\n\n    if (Y) {\n      let p = X.transpose()\n        .mmul(t)\n        .div(\n          t\n            .transpose()\n            .mmul(t)\n            .get(0, 0),\n        );\n      p = p.div(p.norm());\n      let xResidual = X.clone().sub(t.clone().mmul(p.transpose()));\n      let residual = u\n        .transpose()\n        .mmul(t)\n        .div(\n          t\n            .transpose()\n            .mmul(t)\n            .get(0, 0),\n        );\n      let yResidual = Y.clone().sub(\n        t\n          .clone()\n          .mulS(residual.get(0, 0))\n          .mmul(q.transpose()),\n      );\n\n      this.t = t;\n      this.p = p.transpose();\n      this.w = w.transpose();\n      this.q = q;\n      this.u = u;\n      this.s = t.transpose().mmul(t);\n      this.xResidual = xResidual;\n      this.yResidual = yResidual;\n      this.betas = residual;\n    } else {\n      this.w = w.transpose();\n      this.s = t\n        .transpose()\n        .mmul(t)\n        .sqrt();\n      if (scaleScores) {\n        this.t = t.clone().div(this.s.get(0, 0));\n      } else {\n        this.t = t;\n      }\n      this.xResidual = X.sub(t.mmul(w.transpose()));\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}